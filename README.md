# 叶叙 聊天室

一个基于 Node.js 和 Socket.io 构建的实时聊天应用，支持多媒体文件分享和在线预览。设计简洁现代，部署便捷。

![叶叙聊天室](https://img.shields.io/badge/叶叙-聊天室-brightgreen)
![版本](https://img.shields.io/badge/版本-1.0.0-blue)
![协议](https://img.shields.io/badge/协议-MIT-orange)

## 📝 项目简介

叶叙聊天室是一个功能丰富而架构简洁的实时通讯应用，提供用户注册登录、实时消息传递、多媒体文件分享、消息引用回复、消息撤回与编辑等功能。界面采用现代简约设计，主色调以粉色、白色和蓝色为主，支持响应式布局，适配移动端和桌面端。采用轻量级技术栈，使用SQLite数据库进行数据存储，一键部署即可使用。

## ✨ 功能特点

- **用户系统**：支持注册、登录和记住登录状态
- **实时通讯**：基于 Socket.io 的即时消息传递
- **多媒体分享**：支持图片、视频、音频和文档等多种格式文件上传与预览
- **消息互动**：支持消息引用回复、表情选择、消息撤回和编辑
- **用户状态**：显示在线用户列表和用户头像（空头像自动隐藏）
- **界面设计**：现代简约风格，粉蓝白配色，响应式设计
- **数据处理**：消息撤回时自动删除相关文件，减少存储占用
- **数据持久化**：使用SQLite数据库存储聊天记录和用户信息
- **密码重置工具**：管理员专用的命令行密码重置工具，可快速重置用户密码
- **轻量级架构**：使用SQLite内嵌数据库，无需复杂的数据库配置，系统资源占用少
- **即插即用**：简单几步操作即可完成部署，无需复杂配置
- **容器化部署**：支持Docker容器化部署，便于在各种环境快速启动

## 💪 项目优势

- **设计美观**
  - 现代简约UI设计，粉色、白色、蓝色的清新配色
  - 响应式布局，完美适配不同尺寸的设备
  - 精心设计的动画和过渡效果，提升用户体验
  - 无障碍设计考量，确保良好的可用性

- **简洁性**
  - 原生JavaScript开发，无需复杂框架，代码清晰易懂
  - 使用SQLite数据库存储，兼具简便性和可靠性
  - 模块化设计，结构清晰，易于理解和维护
  - 精简依赖，减少冗余代码和潜在漏洞

- **部署便捷性**
  - 一键安装依赖：仅需一条npm命令即可安装所有依赖
  - 零配置启动：无需环境变量配置即可运行
  - 自动创建必要目录和数据库：首次运行自动生成所需文件结构
  - 支持快速迁移：整个应用和数据库可在不同环境间轻松迁移
  - 低系统资源需求：适用于各种规格的服务器环境
  - Docker支持：支持容器化部署，无需担心环境配置问题

## 🛠️ 技术栈

- **前端**：HTML5, CSS3, JavaScript (原生)
- **后端**：Node.js, Express
- **实时通信**：Socket.io
- **文件处理**：Multer
- **数据存储**：SQLite 数据库
- **ORM工具**：Sequelize
- **其他工具**：UUID, dotenv
- **容器化**：Docker

## 🚀 安装和运行

### 前提条件

- Node.js (v12.0.0 或更高版本)
- npm (v6.0.0 或更高版本)
- 或者 Docker (用于容器化部署)

### 方式一：传统部署

1. 克隆仓库

```bash
git clone https://github.com/Aiky156/yexu-chat.git
cd yexu-chat
```

2. 安装依赖

```bash
npm install
```

3. 启动服务器

```bash
npm start
```

4. 访问应用

打开浏览器，访问 `http://localhost:3000`

### 方式二：Docker部署

直接使用Docker Hub官方镜像快速部署（推荐）：

```bash
# 拉取官方镜像并运行
docker pull aiky156/yexu-chat:latest
docker run -d -p 3000:3000 -v yexu-data:/app/data -v yexu-uploads:/app/uploads --name yexu-chat aiky156/yexu-chat:latest
```

访问应用：打开浏览器，访问 `http://localhost:3000`

> 提示：
> - 默认端口映射是3000:3000，如需修改可使用 `-p 8080:3000` 将容器3000端口映射到主机的8080端口
> - 生产环境建议使用Nginx反向代理，支持HTTPS访问增强安全性

## 📱 使用流程

### 用户认证

1. 首次访问时，系统会自动生成随机头像并提示用户注册或登录
2. 注册：输入用户名和密码，可以更换随机头像
3. 登录：输入已注册的用户名和密码，可选择"记住我"保持登录状态

### 聊天功能

1. 发送文本消息：在输入框中输入内容，点击发送按钮或按回车键
2. 发送文件：点击文件上传按钮，选择文件后点击发送
3. 使用表情：点击表情按钮，从表情选择器中选择表情
4. 引用回复：点击消息右上角的回复按钮，输入回复内容后发送
5. 撤回消息：点击自己发送的消息右上角的撤回按钮，可在30秒内重新编辑
6. 查看在线用户：点击侧边栏切换按钮，查看当前在线用户列表
7. 查看媒体文件：点击聊天中的媒体文件缩略图，可在弹窗中查看大图或播放媒体

### 管理员功能

1. **密码重置工具**
   - 系统管理员可通过命令行工具快速重置用户密码
   - 运行方式：在项目根目录执行 `node reset-password.js`
   - 支持功能：
     - 按用户名查找用户
     - 使用默认密码(123456)或自定义密码
     - 批量重置多个用户密码
   - 适用场景：用户忘记密码，需要管理员协助重置

## 📁 项目结构

```
yexu-chat/
├── data/               # 数据目录
│   └── database.sqlite # SQLite数据库文件（项目启动后自动生成）
├── models/             # 数据模型目录
│   ├── User.js         # 用户模型
│   ├── Message.js      # 消息模型
│   └── index.js        # 模型关联
├── public/             # 前端静态资源
│   ├── css/            # 样式文件
│   │   └── style.css   # 主样式文件
│   ├── js/             # JavaScript文件
│   │   └── app.js      # 主应用逻辑
│   └── index.html      # 主HTML文件
├── uploads/            # 上传文件存储目录（自动生成）
├── server.js           # 服务器入口文件
├── reset-password.js   # 管理员密码重置工具
├── package.json        # 项目配置和依赖
└── README.md           # 项目说明文档
```

## 📄 文件说明

### 前端文件

- **index.html**: 应用的主HTML结构，包含用户界面元素
- **style.css**: 定义应用的现代简约样式和响应式布局
- **app.js**: 前端主逻辑，处理用户交互、Socket.io通信和UI更新

### 后端文件

- **server.js**: 服务器入口文件，包含Express配置、Socket.io事件处理和API路由
- **reset-password.js**: 管理员命令行工具，用于重置用户密码，支持默认密码或自定义密码
- **package.json**: 项目依赖和脚本配置

### 数据文件与模型

- **database.sqlite**: SQLite数据库文件，存储所有应用数据
- **User.js**: 用户数据模型，定义用户表结构
- **Message.js**: 消息数据模型，定义消息表结构
- **index.js**: 定义模型之间的关联关系

## 最近更新

- **数据存储升级**：从JSON文件存储升级到SQLite数据库，提升数据管理效率和可靠性
- **新增密码重置工具**：添加管理员专用的命令行密码重置工具，方便管理员协助用户重置密码
- 优化UI设计：采用现代简约风格，以粉色、白色和蓝色为主色调
- 修复头像显示问题：空头像自动隐藏，改善界面整洁度
- 改进消息撤回功能：撤回消息时自动删除相关文件
- 增强表情选择器体验：改进移动端适配
- 优化消息引用和预览功能：提升用户交互体验
